vscode:
  extensions:
    - leanprover.lean4

tasks:
  - name: Setup & Run Game
    init: |
      set -e
      curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
      echo 'export NVM_DIR="$HOME/.nvm"' >> ~/.bashrc
      echo '[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"' >> ~/.bashrc
      echo '[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"' >> ~/.bashrc
      export NVM_DIR="$HOME/.nvm"
      [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
      nvm install 22.2.0
      curl https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh -sSf | sh -s -- -y
      source "$HOME/.elan/env"
      git submodule update --init --recursive
      export PATH="$HOME/.elan/bin:$PATH"
      cd games/FermatGame
      lake update
      lake exe cache get || true
      lake build
      cd ../..
      npm install
    command: |
      source ~/.bashrc
      nvm use 22.2.0
      npm start

ports:
  - port: 3000
    onOpen: open-preview
    name: FermatGame
    description: Access the game frontend here
  - port: 8080
    onOpen: ignore
    name: Backend Server
    description: The Lean language server backend
